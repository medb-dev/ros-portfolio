<!DOCTYPE html>
<html class="no-js vlt-is--single-post vlt-is--footer-fixed" lang="en">

<!-- Mirrored from paul-themes.com/html/gilber/single-post.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 01 Dec 2021 07:20:45 GMT -->
<head>
<meta charset="utf-8">
<title>Robert Sabados</title>
<meta name="description" content="Personal CV/Resume HTML5 Template">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="icon" type="image/svg" href="assets/img/root/favicon.svg">

<link rel="stylesheet" href="assets/css/framework/bootstrap.min.css">

<link rel="stylesheet" href="assets/fonts/Gilroy/style.css">

<link rel="stylesheet" href="assets/fonts/LineIcons/Pro-Regular/font-css/LineIcons.css">

<link rel="stylesheet" href="assets/css/vlt-plugins.min.css">

<link rel="stylesheet" href="assets/css/vlt-main.min.css">

<link rel="stylesheet" href="assets/css/custom.css">
</head>
<body class=" animsition">
<!-- Header -->
<header class="vlt-header vlt-header--default">
    <div class="vlt-navbar vlt-navbar--main vlt-navbar--transparent vlt-navbar--sticky">
    <div class="vlt-navbar-background"></div>
    <div class="vlt-navbar-inner">
    <div class="vlt-navbar-inner--left">
    <a class="vlt-navbar-logo" href="index.html"><img src="assets/img/root/logo.svg" alt="Robert Sabados"></a>
    </div>
    <div class="vlt-navbar-inner--center">
    <div class="container">
    <nav class="vlt-default-menu__navigation">
    
    <ul class="sf-menu">
    <li data-menuanchor="Home"><a href="index.html#Home">Home</a></li>
    <li data-menuanchor="About"><a href="index.html#About">About</a></li>
    <li data-menuanchor="Projects"><a href="index.html#Projects">Projects</a></li>
    <li data-menuanchor="Blog"><a href="index.html#Blog">Blog</a></li>
    </ul>
    </nav>
    </div>
    </div>
    <div class="vlt-navbar-inner--right">
    <div class="d-flex align-items-center">
    
    <div class="vlt-navbar-contacts" data-menuanchor="Contact">
        <a href="index.html#Contact" style="font-weight: 700;">Contact</a>
        <!-- <a href="tel:+72126742510">+7 (212) 674-25-10</a> -->
    </div>
    <a class="vlt-menu-burger js-offcanvas-menu-open" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></svg></a>
    </div>
    </div>
    </div>
    </div>
    </header>
    <!-- Burger Header -->
    <div class="vlt-offcanvas-menu">
    <div class="vlt-offcanvas-menu__header">
    
    <a class="vlt-menu-burger vlt-menu-burger--opened js-offcanvas-menu-close" href="#"><svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="square" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><defs /><path d="M18 6L6 18M6 6l12 12" /></svg></a>
    </div>
    <nav class="vlt-offcanvas-menu__navigation">
    
    <ul class="sf-menu">
        <li data-menuanchor="Home"><a href="index.html#Home">Home</a></li>
        <li data-menuanchor="About"><a href="index.html#About">About</a></li>
        <li data-menuanchor="Projects"><a href="index.html#Projects">Projects</a></li>
        <li data-menuanchor="Blog"><a href="index.html#Blog">Blog</a></li>
        <li data-menuanchor="Contact"><a href="index.html#Contact">Contact</a></li>
    </ul>
    </nav>
    <div class="vlt-offcanvas-menu__footer">
    
    <div class="vlt-offcanvas-menu__socials">
        <a class="vlt-social-icon vlt-social-icon--style-1" 
    href="mailto:sabados.robert1989@gmail.com"
    target="_blank">
        <i class="lnir-google"></i>
    </a>
    <a class="vlt-social-icon vlt-social-icon--style-1" 
    href="https://www.linkedin.com/in/robert-sabados/"
    target="_blank">
        <i class="lnir-linkedin-original"></i>
    </a>
    <a class="vlt-social-icon vlt-social-icon--style-1" 
    href="https://join.skype.com/invite/yV5aOVnl4wfu"
    target="_blank">
        <i class="lnir-skype"></i>
    </a>
    </div>
    
    <div class="vlt-offcanvas-menu__copyright">
    <p>© 2020 Copyright.<br>All rights reserved.</p>
    </div>
    </div>
    </div>

<div class="vlt-site-overlay"></div>
<!-- social -->
<div class="vlt-fixed-socials">
    <a class="vlt-social-icon vlt-social-icon--style-1" 
    href="mailto:sabados.robert1989@gmail.com"
    target="_blank">
        <i class="lnir-google"></i>
    </a>
    <a class="vlt-social-icon vlt-social-icon--style-1" 
    href="https://www.linkedin.com/in/robert-sabados/"
    target="_blank">
        <i class="lnir-linkedin-original"></i>
    </a>
    <a class="vlt-social-icon vlt-social-icon--style-1" 
    href="https://join.skype.com/invite/yV5aOVnl4wfu"
    target="_blank">
        <i class="lnir-skype"></i>
    </a>
</div>

<main class="vlt-main">
<section>
<div class="vlt-post-hero-title jarallax" style="padding-top:200px ;"><img class="jarallax-img" src="assets/img/next.png" alt="" loading="lazy">
<div class="container">
<div class="row">
<div class="col-xl-10">

<div class="vlt-animated-block" data-animation-name="fadeInUpSm" style="animation-delay:0s; animation-duration:700ms;"><span class="vlt-post-date">November 22, 2021</span>
<h3 class="vlt-post-title">How to deploy a strict Content Security Policy (CSP) with Next.js</h3>
</div>
</div>
</div>
</div>
</div>
</section>

<section>
<div class="vlt-gap-140"></div>
<div class="container">
<div class="row">
<div class="col-lg-8 offset-lg-2">

<div class="vlt-animated-block" data-animation-name="fadeInUpSm" style="animation-delay:.1s; animation-duration:700ms;">
<p> 
    Based on the most comprehensive study to date from Google, 95% of real-world Content Security Policy (CSP) deployments are bypassed and 99.34% of hosts with CSP use policies that offer no benefit against XSS.
    <br>This is why Google suggests that the model of designating trust by specifying URL whitelists from which scripts can execute should be replaced with an approach based on nonces and hashes, already defined by the CSP specification and available in major browser implementations. Hence the name strict CSP.
    <br>
    <br>In the context of a Single Page App (SPA) such as the Next.js React framework, we need to use a Hash-based CSP in order to properly integrate a strict CSP which will offer real protection against CSS attacks.
    <br>
    <br>Depending on the complexity of your application, the integration of a hash-based Content Security Policy could be trivial and require a lot of code manipulation. That’s why I’ve come to build a package on NPM specifically designed for Next.js to allow developers to integrate strict CSP in a snap with just a few lines of code.
    <br>
    <br>
    <br>next-strict-csp
    <br>next-strict-csp is a hash-based Strict Content Security Policy generator for Next.js that is easily integrated in the _document.tsx file of your Next.js application. Once in production, it will automatically inject the hashes into the content security policy meta tag and protect against XSS once deployed and cached on CDN.
    <br>
    <br>Here is an example of _document.tsx with basic integration of next-strict-csp:<br>
    <span class="text-code">
    <br>...
    <br>// Next.js libraries
    <br>import Document, { Html, Head, Main, NextScript } from 'next/document'
    <br>// Next Strict Content Security Policy
    <br>import { NextStrictCSP } from 'next-strict-csp'
    <br>...
    <br>// Enable Head Strict CSP in production mode only
    <br>const HeadCSP = process.env.NODE_ENV === 'production' ? NextStrictCSP : Head
    <br>...
    <br>// Document component
    <br>class MyDoc extends Document {
    <br>  render() {
    <br>    return (
    <br>      &lt Html &gt
    <br>        &lt HeadCSP &gt
    <br>          { process.env.NODE_ENV === 'production' && 
    <br>          &lt meta httpEquiv="Content-Security-Policy" / &gt
    <br>          }
    <br>          ...
    <br>        &lt /HeadCSP &gt
    <br>        &lt body &gt
    <br>          ...
    <br>          &lt Main / &gt
    <br>          &lt NextScript / &gt
    <br>          ...
    <br>        &lt /body &gt
    <br>      &lt /Html &gt
    <br>    )
    <br>  }
    <br>}
    </span>
    <br>Once put live in production, you'll get a content security policy meta tag that looks like this:
    <span class="text-code">
    <br>&lt meta
    <br>    http-equiv="Content-Security-Policy"
    <br>    content="script-src 'strict-dynamic'
    <br>            'sha256-XOzjewwkvGMLaoj+oYCiOZ3kRwb6RT1Ph6vn4qL+XI0='
    <br>            'unsafe-inline'
    <br>            http: https:;" 
    <br>    slug="/"
    <br>&gt
    </span> 
    <br>With a strict CSP, you need to hash your inline scripts as well. This could be easily achieved with next-strict-csp by integrating your inline scripts in an array like this in _document.tsx:
    <span class="text-code">
        <br>...
        <br>// Next.js libraries
        <br>import Document, { Html, Head, Main, NextScript } from 'next/document'
        <br>// Next Strict Content Security Policy
        <br>import { NextStrictCSP } from 'next-strict-csp'
        <br>...
        <br>// Cloudflare Insights Script (Optional)
        <br>const cloudflareJs = `var s = document.createElement('script')
        <br>s.src = 'https://static.cloudflareinsights.com/beacon.min.js'
        <br>s.setAttribute('data-cf-beacon', '{"token": "YOUR CLOUDFLARE WEB ANALYTICS TOKEN STRING"}')
        <br>document.body.appendChild(s)`
        <br>// Google Tag Manager Script (Optional)
        <br>const GTMJs = `(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        <br>new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        <br>j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        <br>'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        <br>})(window,document,'script','dataLayer','YOUR GOOGLE TAG MANAGER ID STRING');`
        <br>// Next Strict CSP
        <br>// Inline scripts to hash  (Optional)
        <br>NextStrictCSP.inlineJs = [
        <br>  cloudflareJs,
        <br>  GTMJs
        <br>]
        <br>...
        <br>// Enable Head Strict CSP in production mode only
        <br>const HeadCSP = process.env.NODE_ENV === 'production' ? NextStrictCSP : Head
        <br>...
        <br>// Document component
        <br>class MyDoc extends Document {
        <br>  render() {
        <br>    return (
        <br>      &lt Html &gt
        <br>        &lt HeadCSP &gt
        <br>          { process.env.NODE_ENV === 'production' && 
        <br>          &lt meta httpEquiv="Content-Security-Policy" / &gt
        <br>          }
        <br>          ...
        <br>          {/* Google Tag Manager */}
        <br>          { process.env.NODE_ENV === 'production' && 
        <br>          &lt script 
        <br>            dangerouslySetInnerHTML={{
        <br>                __html: GTMJs
        <br>            }}
        <br>          / &gt
        <br>          }
        <br>          {/* End Google Tag Manager */}
        <br>        &lt /HeadCSP &gt
        <br>        &lt body &gt
        <br>          { process.env.NODE_ENV === 'production' && 
        <br>          &lt noscript
        <br>            dangerouslySetInnerHTML={{
        <br>                __html: `&lt iframe src="https://www.googletagmanager.com/ns.html?id=YOUR GOOGLE TAG MANAGER ID STRING" height="0" width="0" style="display:none;visibility:hidden" &gt&lt /iframe &gt`,
        <br>            }}
        <br>          / &gt
        <br>          }
        <br>          ...
        <br>          &lt Main / &gt
        <br>          &lt NextScript / &gt
        <br>          {/* Cloudflare Web Analytics */}
        <br>          {/*&lt script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon={`{"token": "YOUR CLOUDFLARE WEB ANALYTICS TOKEN STRING"}`} &gt&lt /script &gt*/}
        <br>          {process.env.NODE_ENV === 'production' && 
        <br>          &lt script dangerouslySetInnerHTML={{
        <br>            __html: cloudflareJs
        <br>          }} / &gt
        <br>          }
        <br>          {/* End Cloudflare Web Analytics */}
        <br>          ...
        <br>        &lt /body &gt
        <br>      &lt /Html &gt
        <br>    )
        <br>  }
        <br>}    
    
    </span> 
    <br>Once live, your inline scripts hashes will be injected into the content security policy meta tag like this:
    <span class="text-code">
        <br>&ltmeta 
        <br>    http-equiv="Content-Security-Policy"
        <br>    content="script-src 'strict-dynamic'
        <br>             'sha256-XOzjewwkvGMLaoj+oYCiOZ3kRwb6RT1Ph6vn4qL+XI0='
        <br>             'sha256-QSxH3dqIUPdeBvyxSZSuIbZfgtCo/yuqnzU+5gtq9Ak='
        <br>             'sha256-7V8IQTE3j8PL2rD62J9XsmUhchGnkkyNIQfwoYVK04I='
        <br>             'unsafe-inline'
        <br>             http: https:;"
        <br>     slug="/"
        <br>&gt    
    </span> 
    <br>
    <span style="font-size: 1.5rem;font-weight: 600;">
        Thanks for reading, see you!!
    </span>
</p>
</div>
</div>
</div>
</div>
<div class="vlt-gap-10"></div>
</section>
<section>
<div class="vlt-gap-40"></div>
<div class="container">
<div class="row">
<div class="col-lg-8 offset-lg-2">
<div class="vlt-animated-block" data-animation-name="fadeInUpSm" style="animation-delay:0s; animation-duration:700ms;">
<div class="container">
<div class="row">
<div class="col-lg-8 offset-lg-2">
<div class="vlt-post-tags">
<h5>Tags:</h5><a href="#"> #Dev_News </a><a href="#"> #strict_content </a><a href="#"> #next_js </a>
</div>
</div>
</div>
</div>
<div class="vlt-gap-30"></div>
</section>

</main>

<footer class="vlt-footer vlt-footer--default vlt-footer--fixed">
<div class="vlt-footer-copyright">
<p>© Robert Sabados. 2021</p>
</div>
</footer>

<script src="assets/vendors/jquery-3.5.1.min.js"></script>
<script src="assets/scripts/vlt-plugins.min.js"></script>
<script src="assets/scripts/vlt-helpers.js"></script>
<script src="assets/scripts/vlt-controllers.min.js"></script>
</body>

<!-- Mirrored from paul-themes.com/html/gilber/single-post.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 01 Dec 2021 07:22:20 GMT -->
</html>